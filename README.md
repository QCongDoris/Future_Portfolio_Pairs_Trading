# Manual for the Project Template of Future-Portfolio Pairs Trading Algorithm
This strategy is built based on the mean-reverting property of stationary time
series. Considering the no-short ban on China's A-Share market, some stocks within
the specified stock pool will be selected to construct a portfolio first. Then some
futures will be adopted for hedging purposes.

The logical structure of this strategy is described below in `section 1`. An
overview of the scripts and folders is in `section 2`. `section 3` lists the
environment settings of Python packages adopted in the development of this strategy.
For detailed definitions and illustrations of each function, please refer to the
comments attached in the codes.

## 1. Systematic Logic of Project

### 1.1. Input
The input should be a `str` type of date, formatting as `YYYY-MM-DD`.

If this is the first time running this program, initial amount of capital and margin
ratio for future trading will also be requested as input.

Other primary settings, including the stock pool, portfolio update frequency, model
parameters, and so on, are specified in the configuration file. Developers can make
changes if necessary.

### 1.2. Data Wrangling
The close price of stocks along with the future will be downloaded. It would take
around 10 minutes, depending on your Internet connection.

The downloaded/updated datasets will be saved in the `data` folder.

### 1.3. Construction of Stationary Series
_LASSO_ regression will be adopted to construct a stationary portfolio. To save
for transaction costs, this construction and re-construction will only be performed
on the first business day of each month.

Coefficients generated by _LASSO_ will be saved in the `output` folder for checking
+and usage later.

The downloaded/updated datasets will be saved in the `data` folder. The corresponding
contents of each file are illustrated below.

### 1.4. Model Fitting for Stationary Series
An _AR_ model will be trained using the historical data, for predicting the
long-run mean trend of the stationary series. A _GARCH_ model will be trained
simultaneously for predicting the volatility of the stationary series.

These two models will be updated every time to better monitoring the market
situation and current state of our strategy. The predicted long-term mean and volatility
will be saved and updated to the `output` folder for checking and usage later.

### 1.5. Trading Signal Generating
With the estimated long-term mean and volatility of strategy, a two-sided boundary
will be generated for trading signal production. The logic for signal generating
is listed below:

- If the current paired series value is below the lower bound, the stock portfolio
should take a long position, while the future should take a short one.
- If the current paired series value is higher than the estimated long-term mean level,
all positions should be closed.




## 2. Overview of the Scripts and Folders
### `addpath.py`
Scripts for files paths. Created and called for better referring between scripts.

### `main.py`
The main file to run the algorithm. Run this file to generate straightforward
signals for trading every day. An input of date will be requested when running
this script. Besides, if this is the first time running this strategy, some extra
inputs would be requested for initialization purpose.

### `README.md`
The current scripts. A manual for the project template.

### `algorithm`
Packed scripts and functions for this trading algorithm. Will be utilized to do
the computations.

### `config/config.conf`
Configuration script. For parameters in the `inputs` part:
- `future_margin_ratio`: The margin ratio for short selling future contract in the
aimed market. Will be requested upon first running this strategy, then be recorded in
the configuration and never asked as input again.
- `input_date`: The date which user would like to get signals for. Will be requested
as input every time when running this strategy.
- `initial_capital`: The initial capitalization for running this strategy. Will be
requested upon first running this strategy, then be recorded in the configuration and
never asked as input again.

For parameters in the `parameters` part:
- `ar_p`: The order considered when training the AR model. 1 as default.
- `boundary_ratio`: Ratio for constructing signal boundaries. The boundaries will be selected
as _mean +/- boundary_ratio * sd_. 0.5 as default.
- `future_code`: The code for specifying future contract. Should be matched with the stock
pool. _IFM_ for CSI300 Index future, _ICM_ for CSI500 Index future, _IMM_ for CSI1000 Index
future.
- `future_size`: Size for future contracts. Will be calculated according to `initial_capital`,
`future_margin_ratio`, `spare_future_margin`, and value of portfolio, and recorded in the
configuration.
- `garch_p`: The number of lag variances to include in the GARCH model. 1 as default.
- `garch_q`: The number of lag residual errors to include in the GARCH model. 1 as default.
- `initialization_status`: The code for identifying if this is the first time running this
strategy. 1 if so and 0 if not. After first initialization, this value would be set to 0
automatically. When first time running, please check and make sure this value is set to 1.
- `lasso_alpha`: Tuning parameter value for training the LASSO regression model. A larger
alpha will result in fewer selected stocks. 5 as default.
- `spare_future_margin_ratio`: Spare ratio for future margin. Its relationship with future value
and future margin ratio can be represented as `spare_future_margin_ratio = future_margin_value /
(future_margin_value + spare_margin_value)`, where `future_margin_value = future_margin_ratio *
future_size * future_contract_value`, _spare_margin_value_ will be calculated according to
`future_size * future_contract_value = portfolio_value`.
- `stock_pool`: The code for specifying stock pool. _000300.SH_ for CSI300 Index Component,
_000905.SH_ for CSI500 Index Component

### `data`
Downloaded price data.

### `output`
Output files during the algorithm. Including the parameters estimated during the
process and eventual results. The weight allocation for stocks will be stored in
the .csv file named `port_weights.csv` and the contract size will be stored in
the .csv dile named `future_size.csv`.


## 3. Python Environment and Package Settings
Anaconda is introduced for environment management. The requirements for packages
along with their versions are saved in the file `environment.yml`. Anaconda users
can create a conda virtual environment with the following command:
`conda env create --name <my-env-name> --file environment.yml`.